<style>
    #qrcode p {
        color: #0074c9;
    }

    #qrcode img {
        border: 1px solid #ccc;
        padding: 2px;
        width: 160px;
    }

    .vm {
        border: 0 !important;
        border-radius: 2px !important;
        box-shadow: none;
        padding: 5px 10px;
        font-size: 12px;
        line-height: 1.6;
        color: #fff;
        font-weight: 400 !important;
    }

    .vm img {
        width: 90px;
        height: 45px;
    }

    .gray {
        color: gray;
    }
</style>
<!--{if ($mugglepay['integral_proportion'] && $mugglepay['integral_type'] && $mugglepay['mchid'])}-->
<div style="padding:20px;border:1px solid #ccc;border-top:0;line-height: 36px;">
    <p><strong>请输入要充值的人民币金额</strong></p>
    <p><input type="text" name="money" id="money" value="" size="10" class=""/>元</p>
    <p class="gray">1元人民币可以兑换 {$mugglepay['integral_proportion']}
        {$_G['setting']['extcredits'][$mugglepay['integral_type']]['title']}</p>
    <p id="button">
        <!--{if $mugglepay['alipay'] == 1 }-->
        <button type="button" onclick="onSubmit('alipay')" class="vm">
          <img src="{$_G['siteurl']}/source/plugin/MugglePayForDiscuz/images/alipay.svg" />
        </button>
        <!--{/if}-->
        <!--{if $mugglepay['wechat'] == 1 }-->
        <button type="button" onclick="onSubmit('wechat')" class="vm">
            <svg t="1623997407654" class="icon" viewBox="0 0 3754 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 p-id="13279" width="90" height="45">
                <path d="M433.493333 645.12c-61.44 37.546667-71.68-20.48-71.68-20.48l-78.506666-194.56c-30.72-92.16 23.893333-40.96 23.893333-40.96s47.786667 37.546667 81.92 61.44c37.546667 23.893333 75.093333 6.826667 75.093333 6.826667L965.973333 204.8c-85.333333-122.88-238.933333-204.8-409.6-204.8-283.306667 0-512 218.453333-512 484.693333 0 153.6 75.093333 290.133333 194.56 378.88l-20.48 133.12s-10.24 37.546667 27.306667 20.48c23.893333-13.653333 88.746667-54.613333 122.88-81.92 61.44 23.893333 126.293333 34.133333 187.733333 34.133334 283.306667 0 512-218.453333 512-484.693334 0-78.506667-20.48-150.186667-54.613333-215.04-160.426667 102.4-532.48 344.746667-580.266667 375.466667zM2136.746667 931.84c-40.96 0-61.44-27.306667-61.44-81.92 0-54.613333 20.48-85.333333 61.44-85.333333 27.306667 3.413333 44.373333 17.066667 51.2 44.373333l30.72-10.24c-10.24-40.96-40.96-61.44-85.333334-61.44-58.026667 3.413333-88.746667 37.546667-92.16 109.226667 0 68.266667 30.72 105.813333 92.16 105.813333 51.2 0 78.506667-20.48 85.333334-71.68l-30.72-6.826667c0 40.96-20.48 58.026667-51.2 58.026667zM1897.813333 740.693333c-61.44 3.413333-92.16 40.96-95.573333 109.226667 3.413333 68.266667 34.133333 102.4 98.986667 105.813333 47.786667 0 78.506667-20.48 92.16-61.44l-34.133334-6.826666c-6.826667 30.72-27.306667 44.373333-61.44 44.373333-40.96-3.413333-61.44-27.306667-64.853333-75.093333h157.013333v-6.826667c0-71.68-30.72-105.813333-92.16-109.226667z m-61.44 92.16c3.413333-40.96 23.893333-61.44 61.44-64.853333 37.546667 3.413333 58.026667 23.893333 61.44 64.853333h-122.88zM2075.306667 532.48V146.773333c13.653333-37.546667 27.306667-78.506667 40.96-122.88l-68.266667-20.48c-27.306667 109.226667-61.44 194.56-95.573333 259.413334 0 10.24 3.413333 23.893333 6.826666 40.96 6.826667 27.306667 10.24 51.2 10.24 61.44 13.653333-20.48 23.893333-44.373333 37.546667-64.853334v235.52h68.266667zM1491.626667 232.106667h191.146666v51.2h-191.146666zM1563.306667 669.013333l-68.266667 225.28c-3.413333 13.653333-6.826667 23.893333-6.826667 34.133334 0-13.653333 0-23.893333-3.413333-34.133334l-58.026667-225.28h-34.133333l78.506667 283.306667h30.72l68.266666-225.28c3.413333-13.653333 3.413333-23.893333 3.413334-30.72l-10.24-27.306667zM2604.373333 535.893333c81.92-13.653333 157.013333-37.546667 228.693334-71.68 64.853333 34.133333 139.946667 58.026667 221.866666 71.68 13.653333-27.306667 27.306667-51.2 44.373334-75.093333-71.68-6.826667-136.533333-23.893333-191.146667-44.373333 51.2-47.786667 92.16-98.986667 119.466667-150.186667v-68.266667h-153.6V136.533333h211.626666V71.68h-211.626666v-68.266667h-81.92v68.266667h-215.04V136.533333h215.04v61.44h-174.08v68.266667h85.333333l-47.786667 30.72c30.72 44.373333 68.266667 85.333333 105.813334 116.053333-54.613333 27.306667-122.88 44.373333-201.386667 54.613334 13.653333 17.066667 30.72 40.96 44.373333 68.266666z m119.466667-269.653333h208.213333C2904.746667 307.2 2870.613333 341.333333 2833.066667 372.053333c-44.373333-27.306667-78.506667-64.853333-109.226667-105.813333zM1669.12 897.706667v6.826666c-3.413333 13.653333-3.413333 20.48-3.413333 23.893334 0-10.24-3.413333-20.48-6.826667-34.133334l-61.44-225.28-17.066667 23.893334c0 10.24 0 20.48 3.413334 30.72l68.266666 225.28h30.72l81.92-283.306667h-34.133333l-61.44 232.106667z"
                      fill="#5BC230" p-id="13280"></path>
                <path d="M1856.853333 532.48c3.413333-20.48 13.653333-44.373333 30.72-71.68-27.306667-20.48-47.786667-44.373333-64.853333-71.68 27.306667-64.853333 40.96-143.36 44.373333-228.693333h17.066667v-68.266667h-95.573333c6.826667-23.893333 13.653333-47.786667 20.48-75.093333L1744.213333 3.413333c-17.066667 71.68-34.133333 133.12-58.026666 180.906667V54.613333h-51.2v92.16h-20.48v-136.533333h-54.613334v139.946667h-20.48V54.613333h-47.786666c0-3.413333 3.413333-6.826667 10.24-10.24L1443.84 6.826667c-30.72 44.373333-68.266667 85.333333-105.813333 119.466666 13.653333 17.066667 23.893333 34.133333 30.72 47.786667 3.413333 6.826667 6.826667 10.24 10.24 13.653333 40.96-37.546667 75.093333-78.506667 109.226666-126.293333v119.466667l-40.96-30.72c-30.72 54.613333-68.266667 105.813333-109.226666 153.6 13.653333 30.72 20.48 54.613333 23.893333 75.093333l17.066667-17.066667c6.826667-10.24 13.653333-17.066667 17.066666-17.066666v191.146666h64.853334V256c13.653333-17.066667 23.893333-37.546667 37.546666-58.026667h184.32c0 3.413333-3.413333 6.826667-6.826666 10.24 13.653333 20.48 20.48 40.96 27.306666 58.026667 0 0 3.413333-3.413333 3.413334-6.826667 3.413333-6.826667 10.24-13.653333 10.24-17.066666 3.413333 51.2 13.653333 98.986667 30.72 143.36-13.653333 17.066667-23.893333 37.546667-37.546667 54.613333v-20.48c0-10.24-3.413333-17.066667-3.413333-20.48-17.066667 10.24-27.306667 17.066667-34.133334 23.893333 0 3.413333-3.413333 3.413333-3.413333 3.413334V320.853333h-160.426667c0 13.653333 0 27.306667-3.413333 47.786667v23.893333c0 40.96-13.653333 75.093333-40.96 95.573334 17.066667 17.066667 30.72 30.72 40.96 44.373333 40.96-34.133333 61.44-85.333333 58.026667-157.013333h51.2v78.506666c0 10.24-3.413333 20.48-10.24 30.72l30.72 40.96c17.066667-13.653333 37.546667-30.72 58.026666-44.373333 10.24 17.066667 17.066667 37.546667 27.306667 58.026667 27.306667-23.893333 47.786667-47.786667 68.266667-78.506667 17.066667 23.893333 40.96 51.2 68.266666 71.68zM1781.76 307.2c-10.24-40.96-17.066667-92.16-20.48-146.773333h44.373333c0 54.613333-10.24 102.4-23.893333 146.773333zM2812.586667 935.253333c-17.066667 0-23.893333-6.826667-23.893334-23.893333v-139.946667h37.546667v-23.893333h-37.546667v-71.68l-30.72 17.066667v54.613333H2730.666667v23.893333h27.306666v139.946667c0 30.72 13.653333 47.786667 40.96 44.373333 10.24 0 20.48-3.413333 30.72-6.826666l-6.826666-17.066667c0 3.413333-6.826667 3.413333-10.24 3.413333zM3085.653333 669.013333h-122.88v283.306667h30.72v-116.053333h88.746667c64.853333 0 95.573333-30.72 98.986667-85.333334-6.826667-51.2-40.96-78.506667-95.573334-81.92z m-10.24 139.946667h-81.92v-112.64h81.92c44.373333 0 68.266667 17.066667 68.266667 54.613333s-23.893333 58.026667-68.266667 58.026667zM3409.92 819.2c3.413333-54.613333-23.893333-81.92-81.92-78.506667-51.2-3.413333-81.92 17.066667-92.16 61.44l30.72 6.826667c3.413333-30.72 23.893333-44.373333 61.44-40.96 37.546667-3.413333 54.613333 17.066667 51.2 54.613333-10.24 6.826667-34.133333 10.24-71.68 17.066667-47.786667 3.413333-75.093333 27.306667-75.093333 68.266667 3.413333 34.133333 27.306667 51.2 68.266666 54.613333 37.546667 0 64.853333-10.24 81.92-34.133333 0 10.24 3.413333 20.48 10.24 27.306666h30.72c-6.826667-10.24-13.653333-27.306667-10.24-47.786666V819.2z m-30.72 51.2c-3.413333 37.546667-27.306667 58.026667-68.266667 58.026667-30.72 0-44.373333-10.24-47.786666-30.72 0-20.48 17.066667-34.133333 54.613333-40.96 37.546667-3.413333 58.026667-6.826667 61.44-17.066667v30.72zM3239.253333 532.48h75.093334V119.466667c13.653333-30.72 27.306667-64.853333 37.546666-98.986667l-68.266666-20.48c-27.306667 78.506667-61.44 153.6-112.64 228.693333 3.413333 13.653333 6.826667 34.133333 13.653333 61.44 3.413333 17.066667 6.826667 30.72 10.24 37.546667 17.066667-23.893333 30.72-44.373333 44.373333-68.266667v273.066667zM3515.733333 341.333333c-30.72-40.96-54.613333-75.093333-71.68-95.573333-13.653333-17.066667-20.48-27.306667-27.306666-37.546667l-58.026667 37.546667c34.133333 44.373333 64.853333 88.746667 92.16 136.533333L3515.733333 341.333333z"
                      fill="#5BC230" p-id="13281"></path>
                <path d="M3635.2 102.4V6.826667h-75.093333V102.4h-221.866667v71.68h221.866667v238.933333c0 27.306667-13.653333 40.96-37.546667 40.96-27.306667 0-51.2 0-78.506667-3.413333h-6.826666c10.24 27.306667 13.653333 51.2 17.066666 71.68v6.826667c13.653333 0 37.546667 0 64.853334-3.413334h44.373333c47.786667 0 71.68-27.306667 71.68-85.333333V174.08h75.093333V102.4h-75.093333zM3560.106667 904.533333c-3.413333 3.413333-3.413333 10.24-3.413334 13.653334 0 0 0-3.413333-3.413333-10.24v-6.826667c-3.413333-3.413333-20.48-54.613333-54.613333-157.013333h-34.133334l78.506667 197.973333c-3.413333 13.653333-6.826667 20.48-10.24 27.306667-6.826667 17.066667-20.48 27.306667-34.133333 27.306666-6.826667 0-13.653333 0-20.48-3.413333l-3.413334 17.066667c6.826667 3.413333 17.066667 6.826667 30.72 6.826666 27.306667 3.413333 51.2-13.653333 64.853334-58.026666 6.826667-20.48 37.546667-92.16 88.746666-218.453334h-34.133333l-64.853333 163.84zM2368.853333 740.693333c-27.306667 0-51.2 13.653333-68.266666 37.546667v-109.226667h-30.72v283.306667h30.72v-126.293333c3.413333-34.133333 23.893333-54.613333 58.026666-58.026667 30.72 0 47.786667 20.48 47.786667 58.026667v126.293333h30.72V819.2c3.413333-54.613333-17.066667-81.92-68.266667-78.506667zM2133.333333 532.48h71.68v-27.306667h177.493334v27.306667H2457.6v-204.8h-327.68v204.8z m75.093334-136.533333h177.493333v51.2h-177.493333v-51.2zM2679.466667 819.2c3.413333-54.613333-23.893333-81.92-81.92-78.506667-51.2-3.413333-81.92 17.066667-92.16 61.44l30.72 6.826667c3.413333-30.72 23.893333-44.373333 61.44-40.96 37.546667-3.413333 54.613333 17.066667 51.2 54.613333-10.24 6.826667-34.133333 10.24-71.68 17.066667-47.786667 3.413333-75.093333 27.306667-75.093334 68.266667 3.413333 34.133333 27.306667 51.2 68.266667 54.613333 37.546667 0 64.853333-10.24 81.92-34.133333 0 10.24 3.413333 20.48 10.24 27.306666h30.72c-6.826667-10.24-13.653333-27.306667-10.24-47.786666V819.2z m-30.72 51.2c-3.413333 37.546667-27.306667 58.026667-68.266667 58.026667-30.72 0-44.373333-10.24-47.786667-30.72 0-20.48 17.066667-34.133333 54.613334-40.96 37.546667-3.413333 58.026667-6.826667 61.44-17.066667v30.72zM2133.333333 242.346667h327.68v58.026666h-327.68zM2317.653333 3.413333l-81.92 13.653334c6.826667 17.066667 13.653333 27.306667 17.066667 37.546666 0 3.413333 3.413333 10.24 3.413333 10.24h-146.773333v61.44H2491.733333V64.853333h-146.773333c-10.24-27.306667-20.48-47.786667-27.306667-61.44zM2133.333333 157.013333h327.68v58.026667h-327.68z"
                      fill="#5BC230" p-id="13282"></path>
            </svg>
        </button>
        <!--{/if}-->
        <!--{if $mugglepay['btc'] == 1 }-->
        <button type="button" onclick="onSubmit('btc')" class="vm">
            <img src="{$_G['siteurl']}/source/plugin/MugglePayForDiscuz/images/btc.jpg" />
        </button>
        <!--{/if}-->
        <!--{if $mugglepay['coin'] == 1 }-->
        <button type="button" onclick="onSubmit('coin')" class="vm">
            <img src="{$_G['siteurl']}/source/plugin/MugglePayForDiscuz/images/coin.jpg" />
        </button>
        <!--{/if}-->
    </p>
    <div id="qrcode"></div>
</div>
<!--{else}-->
<div style="padding:20px;border:1px solid #ccc;border-top:0;line-height: 36px;">
    <p><strong>支付功能尚未配置</strong></p>
</div>
<!--{/if}-->

<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script>
    function onSubmit(type) {
        money = $('#money').val();
        if (isNaN(money)) {
            alert('请输入数字');
            exit;
        }
        if (money <= 0) {
            alert('最低1元');
            return;
        }

        $('#button').hide();
        $("#qrcode").html('\n' +
            '<svg width="60px"  height="60px"  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="lds-wheel">\n' +
            '    <g transform="rotate(66 50 50)">\n' +
            '      <animateTransform attributeName="transform" type="rotate" calcMode="linear" values="0 50 50;360 50 50" keyTimes="0;1" dur="1s" begin="0s" repeatCount="indefinite"></animateTransform>\n' +
            '      <ellipse cx="50" cy="50" ng-attr-rx="{{config.radiusOut}}" ry="0.1" fill="none" ng-attr-stroke="{{config.c2}}" ng-attr-stroke-width="{{config.width}}" transform="rotate(0 50 50)" rx="30" stroke="#fac090" stroke-width="5"></ellipse>\n' +
            '      <ellipse cx="50" cy="50" ng-attr-rx="{{config.radiusOut}}" ry="0.1" fill="none" ng-attr-stroke="{{config.c2}}" ng-attr-stroke-width="{{config.width}}" transform="rotate(45 50 50)" rx="30" stroke="#fac090" stroke-width="5"></ellipse>\n' +
            '      <ellipse cx="50" cy="50" ng-attr-rx="{{config.radiusOut}}" ry="0.1" fill="none" ng-attr-stroke="{{config.c2}}" ng-attr-stroke-width="{{config.width}}" transform="rotate(90 50 50)" rx="30" stroke="#fac090" stroke-width="5"></ellipse>\n' +
            '      <ellipse cx="50" cy="50" ng-attr-rx="{{config.radiusOut}}" ry="0.1" fill="none" ng-attr-stroke="{{config.c2}}" ng-attr-stroke-width="{{config.width}}" transform="rotate(135 50 50)" rx="30" stroke="#fac090" stroke-width="5"></ellipse>\n' +
            '    </g>\n' +
            '    <circle cx="50" cy="50" ng-attr-r="{{config.radiusOut}}" fill="none" ng-attr-stroke="{{config.c1}}" ng-attr-stroke-width="{{config.width}}" r="30" stroke="#ff7c81" stroke-width="5"></circle>\n' +
            '    <circle cx="50" cy="50" ng-attr-r="{{config.radiusIn}}" ng-attr-fill="{{config.c3}}" ng-attr-stroke="{{config.c2}}" ng-attr-stroke-width="{{config.width}}" r="10" fill="#ffffcb" stroke="#fac090" stroke-width="5"></circle>\n' +
            '  </svg>');
        $.post("plugin.php?id=MugglePayForDiscuz", {ac: "pay", money: money, type: type}, function (data) {
            data = JSON.parse(data)
            if (data.code == 1) {
                var orderid = data.out_trade_no;
                window.open(data.url);
                checkOrder(orderid);
            }
        });
    }

    function checkOrder(orderid) {
        var repeat = 60;
        var timer = setInterval(function () {
            if (repeat == 0) {
                clearInterval(timer);
            } else {
                repeat--;
                check(orderid);
            }
        }, 2000);
    }

    function check(id) {
        $.post("plugin.php", {id: 'MugglePayForDiscuz', ac: "check", orderid: id}, function (data) {
            if (data == 'paid') {
                $("#qrcode").html('<span style="font-size:14px;font-weight:200;color:#0073c8;margin-top:20px;">恭喜，充值成功!</span>');
                clearInterval(timer);
            }
        });
    }
</script>
